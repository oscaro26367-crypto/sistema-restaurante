<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Restaurante</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .notification { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-red-50">
    <div id="app" class="min-h-screen p-4">
        <div class="text-center py-20">
            <div class="animate-spin w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-600 text-xl">Conectando a Firebase...</p>
        </div>
    </div>

    <!-- Contenedor de notificaciones -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, query, orderBy, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // ============================================
        // üîë AQU√ç PEGAS TUS CREDENCIALES DE FIREBASE
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyD1P0Pu1O83CCgLbSu3ReXoEBMhw5uyOp0",
            authDomain: "sistema-mesero-cocina.firebaseapp.com",
            projectId: "sistema-mesero-cocina",
            storageBucket: "sistema-mesero-cocina.firebasestorage.app",
            messagingSenderId: "857755563486",
            appId: "1:857755563486:web:4a0effdb678903c161d94f",
            measurementId: "G-HEYTHGBEJT"
        };
        // ============================================

        // Inicializar Firebase
        let app, db;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log('‚úÖ Firebase conectado correctamente');
        } catch (error) {
            console.error('‚ùå Error conectando a Firebase:', error);
            document.getElementById('app').innerHTML = `
                <div class="max-w-2xl mx-auto mt-20 bg-red-50 border-2 border-red-200 rounded-xl p-8 text-center">
                    <h2 class="text-2xl font-bold text-red-800 mb-4">Error de Configuraci√≥n</h2>
                    <p class="text-red-700 mb-4">No se pudo conectar a Firebase. Por favor verifica que:</p>
                    <ul class="text-left text-red-600 space-y-2">
                        <li>‚úì Pegaste correctamente las credenciales</li>
                        <li>‚úì Las comillas est√°n bien colocadas</li>
                        <li>‚úì No hay espacios extras</li>
                    </ul>
                    <p class="text-sm text-gray-600 mt-4">Error: ${error.message}</p>
                </div>
            `;
        }

        // Estado de la aplicaci√≥n
        let currentRole = 'mesero';
        let allOrders = [];

        // Escuchar cambios en tiempo real
        const ordersQuery = query(collection(db, 'orders'), orderBy('timestamp', 'desc'));
        onSnapshot(ordersQuery, (snapshot) => {
            allOrders = [];
            snapshot.forEach((docSnap) => {
                const data = docSnap.data();
                allOrders.push({
                    id: docSnap.id,
                    ...data,
                    timestamp: data.timestamp?.toDate() || new Date()
                });
            });
            renderApp();
        });

        // Crear nueva orden
        window.crearOrden = async () => {
            const mesa = document.getElementById('mesa').value.trim();
            const items = document.getElementById('items').value.trim();
            const notas = document.getElementById('notas').value.trim();

            if (!mesa) {
                mostrarNotificacion('‚ö†Ô∏è Por favor ingresa el n√∫mero de mesa', 'error');
                return;
            }

            if (!items) {
                mostrarNotificacion('‚ö†Ô∏è Por favor ingresa los items', 'error');
                return;
            }

            try {
                await addDoc(collection(db, 'orders'), {
                    mesa: mesa,
                    items: items,
                    notas: notas,
                    mesero: 'Mesero #1',
                    estado: 'pendiente',
                    timestamp: serverTimestamp()
                });

                document.getElementById('mesa').value = '';
                document.getElementById('items').value = '';
                document.getElementById('notas').value = '';

                mostrarNotificacion('‚úÖ Orden enviada a cocina', 'success');
            } catch (error) {
                console.error('Error:', error);
                mostrarNotificacion('‚ùå Error al crear orden', 'error');
            }
        };

        // Actualizar estado de orden
        window.actualizarEstado = async (orderId, nuevoEstado) => {
            try {
                const orderRef = doc(db, 'orders', orderId);
                await updateDoc(orderRef, { estado: nuevoEstado });
                mostrarNotificacion(`‚úÖ Orden actualizada a "${nuevoEstado}"`, 'success');
            } catch (error) {
                console.error('Error:', error);
                mostrarNotificacion('‚ùå Error al actualizar', 'error');
            }
        };

        // Cambiar rol
        window.cambiarRol = (nuevoRol) => {
            currentRole = nuevoRol;
            renderApp();
        };

        // Mostrar notificaci√≥n
        function mostrarNotificacion(mensaje, tipo = 'info') {
            const container = document.getElementById('notifications');
            const notif = document.createElement('div');
            
            const colores = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };

            notif.className = `notification ${colores[tipo]} text-white px-6 py-4 rounded-lg shadow-lg max-w-sm`;
            notif.textContent = mensaje;
            
            container.appendChild(notif);

            setTimeout(() => {
                notif.style.opacity = '0';
                notif.style.transform = 'translateX(100%)';
                setTimeout(() => notif.remove(), 300);
            }, 4000);
        }

        // Funci√≥n de renderizado principal
        function renderApp() {
            const app = document.getElementById('app');
            
            const estadoColores = {
                pendiente: 'bg-yellow-100 text-yellow-800 border-yellow-300',
                preparando: 'bg-blue-100 text-blue-800 border-blue-300',
                listo: 'bg-green-100 text-green-800 border-green-300',
                entregado: 'bg-gray-100 text-gray-800 border-gray-300'
            };

            const ordenesActivas = allOrders.filter(o => o.estado !== 'entregado');
            const totalPendientes = ordenesActivas.filter(o => o.estado === 'pendiente').length;
            const totalPreparando = ordenesActivas.filter(o => o.estado === 'preparando').length;
            const totalListos = ordenesActivas.filter(o => o.estado === 'listo').length;

            app.innerHTML = `
                <div class="max-w-7xl mx-auto">
                    <!-- Header -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">
                                    üçΩÔ∏è Sistema de √ìrdenes
                                </h1>
                                <p class="text-gray-600">Tiempo real con Firebase</p>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
                                <!-- Estad√≠sticas -->
                                <div class="flex gap-2">
                                    <div class="bg-yellow-100 px-4 py-2 rounded-lg text-center">
                                        <div class="text-2xl font-bold text-yellow-800">${totalPendientes}</div>
                                        <div class="text-xs text-yellow-600">Pendientes</div>
                                    </div>
                                    <div class="bg-blue-100 px-4 py-2 rounded-lg text-center">
                                        <div class="text-2xl font-bold text-blue-800">${totalPreparando}</div>
                                        <div class="text-xs text-blue-600">Preparando</div>
                                    </div>
                                    <div class="bg-green-100 px-4 py-2 rounded-lg text-center">
                                        <div class="text-2xl font-bold text-green-800">${totalListos}</div>
                                        <div class="text-xs text-green-600">Listos</div>
                                    </div>
                                </div>

                                <!-- Selector de rol -->
                                <select onchange="cambiarRol(this.value)" 
                                        class="px-6 py-3 border-2 border-gray-300 rounded-lg font-bold text-lg focus:outline-none focus:border-orange-500 cursor-pointer">
                                    <option value="mesero" ${currentRole === 'mesero' ? 'selected' : ''}>üë®‚Äçüç≥ Mesero</option>
                                    <option value="cocina" ${currentRole === 'cocina' ? 'selected' : ''}>üî• Cocina</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Contenido Principal -->
                    <div class="grid lg:grid-cols-2 gap-6">
                        ${currentRole === 'mesero' ? `
                            <!-- Panel Mesero -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <div class="flex items-center gap-3 mb-6">
                                    <div class="text-4xl">üë®‚Äçüç≥</div>
                                    <h2 class="text-2xl font-bold text-gray-800">Nueva Orden</h2>
                                </div>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-2">
                                            Mesa * <span class="text-red-500">‚¨§</span>
                                        </label>
                                        <input 
                                            id="mesa" 
                                            type="text" 
                                            placeholder="Ejemplo: Mesa 5" 
                                            class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                                        >
                                    </div>

                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-2">
                                            Items * <span class="text-red-500">‚¨§</span>
                                        </label>
                                        <textarea 
                                            id="items" 
                                            rows="4" 
                                            placeholder="Ejemplo:
2x Hamburguesa Cl√°sica
1x Ensalada C√©sar
3x Coca Cola"
                                            class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                                        ></textarea>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-2">
                                            Notas Especiales (opcional)
                                        </label>
                                        <textarea 
                                            id="notas" 
                                            rows="2" 
                                            placeholder="Ejemplo: Sin cebolla, alergia al man√≠..."
                                            class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                                        ></textarea>
                                    </div>

                                    <button 
                                        onclick="crearOrden()"
                                        class="w-full bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-bold py-4 px-6 rounded-lg text-xl shadow-lg transform transition hover:scale-105"
                                    >
                                        üì§ Enviar a Cocina
                                    </button>
                                </div>
                            </div>
                        ` : `
                            <!-- Panel Cocina -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <div class="flex items-center gap-3 mb-6">
                                    <div class="text-4xl">üî•</div>
                                    <h2 class="text-2xl font-bold text-gray-800">√ìrdenes Activas</h2>
                                </div>

                                <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                                    ${ordenesActivas.length === 0 ? `
                                        <div class="text-center py-16 text-gray-400">
                                            <div class="text-6xl mb-4">üò¥</div>
                                            <p class="text-xl font-medium">No hay √≥rdenes pendientes</p>
                                            <p class="text-sm mt-2">Esperando nuevas √≥rdenes...</p>
                                        </div>
                                    ` : ordenesActivas.map(order => `
                                        <div class="border-3 border-gray-200 rounded-xl p-5 hover:shadow-lg transition-all bg-gradient-to-br from-white to-gray-50">
                                            <div class="flex justify-between items-start mb-3">
                                                <div>
                                                    <h3 class="text-2xl font-bold text-gray-800">${order.mesa}</h3>
                                                    <p class="text-sm text-gray-500 mt-1">
                                                        üïê ${order.timestamp.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})}
                                                    </p>
                                                </div>
                                                <span class="px-4 py-2 rounded-full text-sm font-bold border-2 ${estadoColores[order.estado]}">
                                                    ${order.estado.toUpperCase()}
                                                </span>
                                            </div>
                                            
                                            <div class="bg-white p-4 rounded-lg mb-3 border border-gray-200">
                                                <p class="text-gray-800 text-lg whitespace-pre-line">${order.items}</p>
                                            </div>

                                            ${order.notas ? `
                                                <div class="bg-yellow-50 p-3 rounded-lg mb-3 border-2 border-yellow-200">
                                                    <p class="text-sm text-gray-700 font-medium">
                                                        üìù <span class="font-bold">Nota:</span> ${order.notas}
                                                    </p>
                                                </div>
                                            ` : ''}

                                            <div class="flex gap-2">
                                                ${order.estado === 'pendiente' ? `
                                                    <button 
                                                        onclick="actualizarEstado('${order.id}', 'preparando')"
                                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition transform hover:scale-105"
                                                    >
                                                        üç≥ Comenzar a Preparar
                                                    </button>
                                                ` : ''}
                                                ${order.estado === 'preparando' ? `
                                                    <button 
                                                        onclick="actualizarEstado('${order.id}', 'listo')"
                                                        class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition transform hover:scale-105"
                                                    >
                                                        ‚úÖ Marcar como Listo
                                                    </button>
                                                ` : ''}
                                                ${order.estado === 'listo' ? `
                                                    <div class="flex-1 bg-green-100 text-green-800 font-bold py-3 px-4 rounded-lg text-lg text-center border-2 border-green-300">
                                                        ‚ú® Esperando Entrega
                                                    </div>
                                                ` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `}

                        <!-- Lista de Todas las √ìrdenes -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">
                                ${currentRole === 'mesero' ? 'üìã Mis √ìrdenes' : 'üìä Historial'}
                            </h2>
                            
                            <div class="space-y-3 max-h-[600px] overflow-y-auto pr-2">
                                ${allOrders.length === 0 ? `
                                    <div class="text-center py-16 text-gray-400">
                                        <div class="text-6xl mb-4">üì≠</div>
                                        <p class="text-xl">No hay √≥rdenes registradas</p>
                                    </div>
                                ` : allOrders.map(order => `
                                    <div class="border-2 border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors ${order.estado === 'entregado' ? 'opacity-60' : ''}">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="font-bold text-lg text-gray-800">${order.mesa}</span>
                                            <span class="px-3 py-1 rounded-full text-xs font-bold border ${estadoColores[order.estado]}">
                                                ${order.estado}
                                            </span>
                                        </div>
                                        <p class="text-sm text-gray-600 mb-2 line-clamp-2">${order.items.split('\n')[0]}${order.items.split('\n').length > 1 ? '...' : ''}</p>
                                        <p class="text-xs text-gray-400">
                                            ${order.timestamp.toLocaleString('es-ES', {
                                                day: '2-digit',
                                                month: '2-digit',
                                                hour: '2-digit',
                                                minute: '2-digit'
                                            })}
                                        </p>
                                        
                                        ${currentRole === 'mesero' && order.estado === 'listo' ? `
                                            <button 
                                                onclick="actualizarEstado('${order.id}', 'entregado')"
                                                class="mt-3 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg text-sm transition"
                                            >
                                                ‚úÖ Marcar como Entregado
                                            </button>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Footer con instrucciones -->
                    <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 mt-6">
                        <h3 class="text-lg font-bold text-blue-900 mb-3">üí° ¬øC√≥mo usar el sistema?</h3>
                        <div class="grid md:grid-cols-2 gap-4 text-sm text-blue-800">
                            <div>
                                <p class="font-bold mb-2">üë®‚Äçüç≥ Para Meseros:</p>
                                <ol class="list-decimal list-inside space-y-1">
                                    <li>Selecciona "Mesero" arriba</li>
                                    <li>Llena el formulario con la orden</li>
                                    <li>Click en "Enviar a Cocina"</li>
                                    <li>Cuando est√© lista, m√°rcala como "Entregado"</li>
                                </ol>
                            </div>
                            <div>
                                <p class="font-bold mb-2">üî• Para Cocina:</p>
                                <ol class="list-decimal list-inside space-y-1">
                                    <li>Selecciona "Cocina" arriba</li>
                                    <li>Ver√°s todas las √≥rdenes pendientes</li>
                                    <li>Click en "Comenzar a Preparar"</li>
                                    <li>Cuando termines, "Marcar como Listo"</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render inicial
        renderApp();
    </script>
</body>
</html>